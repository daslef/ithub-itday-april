---
title: Тестовые аккаунты
description: Создание тестовых аккаунтов через Auth и Database
---

import { Image } from 'astro:assets';
import { Aside, LinkCard, CardGrid, Card, Steps } from '@astrojs/starlight/components';
import employeesSchema from '../../../../assets/employees_schema.png'

### Задача

Функционал регистрации пользователей (сотрудников) через приложение не входит в техническое задание, поэтому важно наполнить систему тестовыми пользователями вручную. 

Следуя рекомендациям по проектированию баз данных, разработчики Supabase предлагают нам разделить информацию о пользователях (сотрудниках) на две таблицы - таблицу аккаунтов для аутентикации (она изначально встроена в систему и закрыта от изменений схемы) и отдельную, но связанную с ней, таблицу с дополнительными необходимыми полями. 

### Таблица Аккаунтов

Начнем с создания записей в таблице аккаунтов, так как она является первичной в описанной связке. 

<Steps>
1. перейди на вкладку `Authentication`
2. в разделе `Users` через `Add User -> Create New User` создай две учетные записи: одну для администратора (главы HR-отдела) и одну для сотрудника
</Steps>

<Aside type="note" title="Рекомендация">
Для тестовых целей используй легко запоминающиеся пары учетных данных, например:
`admin@giper.fm` и `adminpass`, `emp1@giper.fm` и `emp1pass`, и не снимай флажок автоматического подтверждения.
</Aside>

### Таблица Сотрудников

Теперь создадим нашу собственную таблицу `employees` с остальными данными о сотрудниках, ориентируясь на следующую схему:

<Image src={employeesSchema} alt="employees table schema" />

В схеме прописано рекомендуемое именование колонок и их тип, а ромб отвечает за обязательность заполнения: закрашенный означает обязательность поля, а, незакрашенный - что поле можно будет оставить пустым.

<Aside type="tip" title="Рекомендация">
Используй графический режим. Создание и редактирование таблиц в нем ближе к табличным процессорам типа `Excel`, чем к сырым запросам `SQL`, что на первых порах нагляднее и защищает от ошибок. 
</Aside>

<Steps>
1. Перейди на вкладку `Table Editor` и начни создавать первую таблицу `employees`
2. На первое время для простоты (данные от тебя ожидает фронтенд) отключи `RLS` и пока **не** подключай `Realtime`, к их настройке мы вернемся позднее
3. К предложенным колонкам `id` и `created_at` добавь свои, ориентируясь на схему выше. 
4. Проверка на обязательность заполнения прячется за иконкой шестеренки, и там же можно включить проверку на уникальность значений
5. У колонки `created_at` уже задано значение по умолчанию `now()`, рекомендуем не менять его. Также, при желании можно выставить значение по умолчанию для колонки `points` равным `'0'::bigint`
</Steps>

<Aside type="caution" title="Здесь внимательно">
Убедись, что создаешь таблицы под схемой `public`, она выбрана по умолчанию
</Aside>

### Внешний ключ

Осталось связать таблицу сотрудников `employees` с таблицей аккаунтов `auth.users`, в которой мы создали двух пользователей ранее. 

Связь будем осуществлять через поле `account_id` в качестве внешнего ключа. 
<Steps>
1. Убедись, что всё еще находишься в той же форме, где настраивал колонки
2. Нажми `Add foreign key relation`
3. В качестве схемы выбери `auth`, а таблицы - `users`
4. Сопоставь колонке `account_id` слева колонку `id` справа 
5. Выбери действие при изменении `CASCADE`
6. Выбери действие при удалении связанных данных - `SET NULL`
7. `Save`
</Steps>

<Aside type="note" title="Заметка">
Позднее, если твоя команда посчитает нужным, ты сможешь добавить дополнительные колонки или перенастроить существующие
</Aside>

### Добавление сотрудников

Добавим в таблицу `employees` две строки для наших созданных пользователей

<Steps>
1. Находясь на странице таблицы, выбери `Insert -> Insert Row`
2. Верхние поля заполнятся автоматически, от тебя требуется: 
    -  должность сотрудника в поле `position` (например, *hr lead* и *mobile dev*)
    - имя в поле `first_name`
    - фамилия в поле `last_name
3. Свяжи запись с соответствующим аккаунтом через `account_id -> Select record`
4. Повтори шаги 1-3 для второго сотрудника
</Steps>

<Aside type="note" title="Заметка">
Когда контент-менеджер команды подготовит дополнительные записи, ты сможешь добавить их к существующим 
</Aside>

<Aside type="tip" title="Что дальше?">
Далее тебе предстоит по схожей логике создать и наполнить таблицу событий и мерча, а также связать таблицы между собой. Но первично дадим возможность фронтенду получать от нас данные по сотрудникам!
</Aside>

