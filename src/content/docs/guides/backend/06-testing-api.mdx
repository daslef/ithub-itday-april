---
title: Тестирование API
description: Тестирование RESTful API на PostgREST с Insomnia 
---

import { Aside, LinkCard, CardGrid, Card } from '@astrojs/starlight/components';

### Цель

На этом этапе тебе предстоит разобраться самому и простыми словами объяснить фронтендерам, по каким адресам и с какими настройками обращаться, чтобы получать или мутировать те или иные данные в таблицах.
Для этого необходимо провести небольшое исследование, изучив документацию `PostgREST` и проверив наши догадки через тестирование специальным клиентом.

### Спецификация API проекта

В нашем случае ресурсами будут: `employees`, `events`, `products`, `orders`

Ниже описаны действия, которые нам нужно реализовать над ресурсами, и дополнительные параметры

| HTTP-запрос | Ресурс | Параметры | Описание |
|-------------|--------|-----------|----------|
| GET | employees | фильтр, сортировка, пагинация | получить данные о сотрудниках |
| PATCH | employees | фильтр | обновить данные о сотруднике / сотрудниках |
| GET | events | фильтр, сортировка, пагинация | получить данные о событиях |
| POST | events | | добавить событие |
| PATCH | events | фильтр | обновить данные о событии / событиях |
| DELETE | events | фильтр | удалить событие / события |
| GET | products | фильтр, сортировка, пагинация | получить данные о мерче |
| PATCH | products | фильтр | изменить данные о мерче |
| GET | orders | фильтр, сортировка, пагинация | получить данные о заказах |
| POST orders | | добавить заказ |

Для проверки работоспособности нашего `API` (который, напомним, уже сгенерировал для нас `Supabase`) 
можно использовать любой `http-клиент`, но мы будем использовать `Insomnia`

### Тестирование API с Insomnia

`Insomnia` - инструмент для тестирования `API` (клиент взаимодействия).
Помимо `REST`, он поддерживает популярные аналоги `GraphQL` и `gRPC`.

пример ответа на GET /employees:
…

Сейчас ответ выглядит хорошо, но по мере роста объема данных такой запрос может стать  непрактичным - возвращаются все имеющиеся данные, даже тогда, когда мы хотим получить информацию о конкретном сотруднике или всех сотрудниках с грейдом lead. 

Для указания дополнительных параметров запросов в REST можно использовать строки запроса (query string). Имена параметров - это колонки таблиц, а возможные значения параметров определяются сервером PostgREST 

Так, для фильтрации мы указываем колонку, по которой хотим фильтровать, и правило фильтрации, например:

GET /employees?id=eq.2 вернет данные по сотруднику с идентификатором 2

Можно включать и несколько параметров запроса, перечисляя их через "&". Например: 
GET /employees?position=like.*lead*&points=neq.0

Второе применение строки запроса, которое нам пригодится — ограничение количества возвращаемых данных (пагинация), которое позволяет снизить объем пересылаемых данных и улучшить пользовательский опыт. Так, запрос GET /orders?offset=40&limit=20 вернет нам 41-60 заказы (третью страницу).

И, наконец, третье применение - сортировка. В PostgREST сортировкой управляет параметр order, а значением может определять одно или несколько правил:

GET /employees?order=created_at отсортирует сотрудников по дате регистрации (от самого раннего времени трудоустройства к тем, кто трудоустроен недавно)

GET /events?order=date_start.asc,date_end.desc отсортирует события по времени начала (от самого ближайшего к самому отдаленному), а при совпадении времени - дополнительно по времени окончания (от самого продолжительного к самому короткому).

Эти параметры можно объединять: например, отфильтровать всех сотрудников разработки со стажем более 2 лет, отсортировать по дате регистрации и вывести первые 10 записей:

### Что дальше

<Aside type="tip" title="Передай фронтендерам">
Бэкенд уже настроил первых пользователей системы. Фронтенд уже может использовать запрос `GET /employees` для запроса информации по сотрудникам. Помимо этого для любого запроса требуется базовый адрес и настройки доступа. Если вы не передали информацию об `URL` и `API KEY`, сделайте это сейчас.
</Aside>


### Что еще почитать по теме

- [Документация PostgREST](https://postgrest.org/en/v12/)
- [Статья об Insomnia на Хабре](https://habr.com/ru/articles/754154/#9)